## 需要完成的功能清单（需求化/验收口径）

### A1 心理稳态数值管理（MentalStats）
- **目标**：为全局系统提供“应激度/解离度”的统一数据源与变化规则，供对话、世界切换、画面反馈等模块读取与订阅。
- **需要维护的状态**：
  - **应激度（Stress）**：可被外部事件增减。
  - **解离度（Dissociation）**：由应激度变化触发的规则计算结果。
- **变更触发**：
  - **仅允许由明确事件驱动**变更应激度（例如：选择对话选项、药物使用、小游戏结算、剧情触发等）。
  - **不允许**以“每帧/随时间自动增减”的方式修改应激度。
- **联动规则**：
  - **数值范围**：应激度（Stress）与解离度（Dissociation）范围均为 **0–100**，任何修改都必须 Clamp。
  - **即时联动**：当应激度发生变化时，系统必须**立即**检查并更新解离度的自动变化状态（见下）。
  - **自动变化规则（每 5 秒 1 点）**：
    - 当 **Stress = 100** 时：解离度按 **每 5s +1** 的速度增加（Clamp 到 100）。
    - 当 **Stress = 0** 时：解离度按 **每 5s -1** 的速度减少（Clamp 到 0）。
    - 当 **0 < Stress < 100** 时：解离度不自动变化（仅响应其他明确事件/规则导致的变化）。
- **对外通知**：
  - 任一数值变化后，必须广播“数值已变化”的通知事件，供 UI 与渲染/效果系统实时更新。

### A2 对话系统（Dialogue）
- **目标**：提供从数据到交互到 UI 的完整对话流程，并在高压状态下对玩家可选话术进行认知干预（隐藏/限制选项）。
- **数据来源与制作**：
  - 支持从表格（Excel/CSV）导入对话数据，并产出可在 Unity 中使用的对话数据资源。
- **对话数据字段要求**（至少）：
  - **内容**：对话文本内容。
  - **跳转**：下一节点标识（用于流程推进）。
  - **数值影响**：该节点/选项对“应激度”的修正值。
  - **解锁/限制条件**：该选项的应激度阈值/上下限条件（用于可见性或可选性判定）。
- **选项显示规则（认知干预）**：
  - 在展示选项前，系统需要读取当前应激度，并根据每个选项的阈值规则决定该选项是否对玩家可见/可选。
  - 需求目标是：**应激度越高，越难出现“冷静/理性”的选项**（具体阈值逻辑以配置为准）。
- **UI 交互体验要求**：
  - **打字机效果**（逐字出现）。
  - **跳过/加速**对话显示。
  - **历史记录**查看已出现的文本。

### A3 世界状态与转化控制（World State & Switching）
- **目标**：管理“现实世界/意识世界”等世界状态，并根据交互与剧情节点触发状态切换，同时驱动相应的视觉反馈。
- **对外能力**：
  - 提供一个可被其他模块调用的“尝试切换世界”入口，输入为交互类型（如床/药物等），输出为是否发生切换以及切换到的目标世界/场景。
- **切换判定规则（按交互类型）**：
  - **床交互（Bed）**：根据当前解离度进行判定，在“高解离/低解离”两端触发进入不同世界（阈值应可配置，默认值可按策划暂定）。
  - **药物交互（Drug）**：根据药物定义强制切换到指定世界/场景。
  - **剧情强制**：当“记忆播放结束”事件发生时，必须强制切换到意识世界。
- **视觉反馈需求**：
  - 解离度变化需要驱动画面风格变化（例如灰度/饱和度降低等），并保证数值变化后视觉反馈能及时更新（具体后处理方案与参数由渲染实现确定）。