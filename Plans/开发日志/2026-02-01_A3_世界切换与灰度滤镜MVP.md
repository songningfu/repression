## 目标
- 实现 A3 世界状态与转化控制（World State & Switching）的 MVP：提供统一入口 `TrySwitchWorld(InteractionType)`，支持床/药物/剧情事件三类触发。
- 实现视觉反馈 MVP：给摄像机加灰度滤镜，**解离度越低画面越灰**（只订阅解离度事件，不反向写核心数值）。

## 变更点
- **WorldState 管理器**：新增 `WorldStateManager`（运行时引导创建、跨场景常驻），提供：
  - `TrySwitchWorld(InteractionType, out WorldType targetWorld, string context=null)`：返回是否发起切换，并输出目标世界
  - `OnWorldSwitched(WorldSwitchedEvent)`：切换完成后广播（在目标场景 loaded 后触发）
- **配置化**：新增 `WorldStateConfig`（Resources 资产 `WorldStateConfig`）：
  - 场景名：Reality / Consciousness
  - 床阈值：解离度 `<=10` 进现实，`>=90` 进意识（中间区间不切换）
  - 灰度映射：`grayscaleAtDissociation0 / grayscaleAtDissociation100`
- **灰度滤镜**：
  - `DissociationGrayscaleEffect`：相机 `OnRenderImage` 灰度渲染，强度由 `MentalStatsManager.OnStatsChanged` 驱动
  - `DissociationGrayscaleInstaller` + `WorldVfxBootstrapper`：每次场景加载自动确保 MainCamera 安装效果（无需改场景）
- **稳定性修复**：修复 `MentalStatsManager` 重复实例告警的根因（Bootstrap 创建 + 场景内手动放置导致重复），实现“优先保留场景内实例”的单例接管策略，避免引用断裂。

## 验收方式
- **世界切换（床）**：
  - 将 `Assets/Scripts/WorldState/BedWorldSwitchInteractable.cs` 挂到 `bed` 对象（或 bed prefab）上
  - 在任意输入/交互系统里调用 `Interact()`：
    - 解离度 0-10：应切到 Reality
    - 解离度 90-100：应切到 Consciousness
    - 其他区间：不切换
- **世界切换（药物/剧情）**：
  - 通过脚本调用 `WorldStateManager.Instance.TrySwitchWorld(InteractionType.MedicineToReality)` 或 `StoryEventToConsciousness`
  - 观察控制台日志与实际场景切换
- **灰度滤镜**：
  - 调整解离度（例如通过现有调试 UI）
  - 观察画面：解离度越低灰度越强；解离度越高越接近原画面
- **重复实例告警**：
  - 进入 Play，不应再出现 “Duplicate MentalStatsManager detected...” 的告警

## 风险与 TODO
- **输入系统未对接**：当前 repo 未发现明确的 “按 F 交互” 输入逻辑；目前提供 `Interact()` 桥接，需后续对接你的交互系统调用。
- **场景加入 Build Settings**：切换世界依赖 `SceneManager.LoadScene(sceneName)`，请确保 `Reality/Consciousness` 已加入 Build Settings，且名称与配置一致。
- **后续扩展**：
  - 增加药物/剧情事件的配置表驱动（而非枚举写死）
  - 增加世界切换过渡效果（淡入淡出/噪点/音效等）

## 对接说明
- **策划**：可在 `Assets/Resources/WorldStateConfig.asset` 调整阈值与灰度强度，无需改代码。
- **程序/交互**：在床交互事件触发时调用 `BedWorldSwitchInteractable.Interact()` 或直接调用 `WorldStateManager.Instance.TrySwitchWorld(...)`。

